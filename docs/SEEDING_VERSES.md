# Seeding Common Verses

Automatically populate your database with common Sunday School memory verses using the Bible API. The verses are created **exactly as if a user added them through the UI** - same fields, same logic, same everything.

## When to Run

Run this **after** setting up your database:
1. Apply all migrations first
2. Then run the seed script

Perfect for:
- Fresh database setup
- After database refresh
- Adding common verses to a new environment

## Quick Start

```bash
cd web
npm run seed:verses
```

This will:
1. Fetch ~30 common Sunday School memory verses from the Bible API (NIV)
2. Insert them using the **exact same logic as the UI** (same fields, same defaults)
3. Skip verses that already exist (active)
4. Reactivate verses that exist but are inactive

## How It Works - Identical to UI

The seed script uses **the exact same logic** as creating verses through the admin panel:

## How It Works - Identical to UI

The seed script uses **the exact same logic** as creating verses through the admin panel:

1. **Same Fields**: Uses all the same database fields
   - `type` = 'verse'
   - `reference` (normalized)
   - `text` (from API)
   - `points_first` (from settings)
   - `points_repeat` (from settings)
   - `active` = true
   - `bible_version` (NIV by default)
   - `id`, `created_at`, `updated_at` (auto-generated by database)

2. **Same Defaults**: Gets points from your `settings` table
   - Just like when a user creates a verse in the UI
   - Respects your configured defaults

3. **Same Duplicate Handling**: 
   - Skips if verse exists and is active
   - Reactivates if verse exists but is inactive
   - Uses the same `reference` unique constraint

4. **Same Validation**: Will validate references (though script has pre-validated list)

**Result**: Seeded verses are indistinguishable from user-created verses!

## Verse List

The script seeds ~30 common verses organized by category:

- **Gospel** (10 verses): John 3:16, Romans 3:23, Romans 6:23, etc.
- **Encouragement** (7 verses): Philippians 4:13, Jeremiah 29:11, etc.
- **Psalms** (5 verses): Psalm 23:1, Psalm 119:11, etc.
- **Love & Obedience** (5 verses): John 13:34, 1 John 4:19, etc.
- **God's Word** (1 verse): 2 Timothy 3:16
- **Faith** (1 verse): 1 Timothy 1:17
- **Christmas** (1 verse): John 1:14

You can edit the `COMMON_VERSES` array in the script to add more.

## Requirements

**Environment Variables** (in `web/.env.local`):

```bash
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
BIBLE_API_KEY=your_api_bible_key  # Optional, but recommended for NIV
```

**Without BIBLE_API_KEY**: Script falls back to bible-api.com (free, KJV only)

## Customizing

### Add More Verses

Edit `COMMON_VERSES` array in [seed-common-verses.js](../web/scripts/seed-common-verses.js):

```javascript
const COMMON_VERSES = [
  'John 3:16',
  'Your New Verse Reference',
  // ... more verses
];
```

### Change Version

Change the `version` variable in the `seedVerses()` function:

```javascript
const version = 'ESV'; // or 'KJV', 'NIV', etc.
```

### Change Points

Points are pulled from your `settings` table. Update them via:
- Admin settings page in the app
- Direct database update

Or hardcode in the script by replacing:
```javascript
❌ Different fields than UI might use

### New Method (API Script)
✅ Fetches current NIV text from API  
✅ Always up-to-date  
✅ Easy to change version  
✅ Validates references  
✅ Handles duplicates gracefully  
✅ **Uses exact same fields and logic as UI**
❌ Hardcoded ESV text  
❌ Text might be outdated  
❌ Difficult to change version  
❌ No validation  

### New Method (API Script)
✅ Fetches current NIV text from API  
✅ Always up-to-date  
✅ Easy to change version  
✅ Validates references  
✅ Handles duplicates gracefully  

## Troubleshooting

### "Missing Supabase credentials"
Make sure `web/.env.local` has both:
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`

### "Failed to fetch" errors
- Check your internet connection
- Verify `BIBLE_API_KEY` is valid (if using API.Bible)
- Some verses might not be available in all translations

### Verses using KJV instead of NIV
- Set `BIBLE_API_KEY` in `web/.env.local`
- Without it, script uses free bible-api.com (KJV only)

### Rate limiting
The script adds a 200ms delay between requests to avoid API rate limits. If you're seeding many verses, this is normal.

## Run Again Anytime
 (unique constraint on reference)
- Updates inactive verses
- Shows clear progress output
- **Verses look exactly like user-created verses in every way**

## After Database Refresh

This script is **perfect for running after a database refresh**:

```bash
# 1. Apply migrations
cd supabase
# (apply migrations via Supabase dashboard or CLI)

# 2. Seed common verses
cd ../web
npm run seed:verses
```

The verses will be ready to use immediately, with all the same properties as if users had added them manually!
- Updates inactive verses
- Shows clear progress output
